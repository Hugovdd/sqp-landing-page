---
import { getCollection } from "astro:content";

import AnimateOnScroll from "@/components/AnimateOnScroll.astro";
import { Background } from "@/components/background";
import { EmailSignup } from "@/components/blocks/email-signup";
import { FAQ } from "@/components/blocks/faq";
import { Hero } from "@/components/blocks/hero";
import ProductShowcase from "@/components/blocks/product-showcase.astro";
import StructuredData from "@/components/StructuredData.astro";
import { SITE } from "@/consts";
import DefaultLayout from "@/layouts/DefaultLayout.astro";
import {
  buildFAQSchema,
  buildItemListSchema,
  buildOrganizationSchema,
  buildWebSiteSchema,
} from "@/lib/seo";

const allProducts = await getCollection("products");
const products = allProducts
  .filter((p) => !p.data.isFree)
  .sort((a, b) => {
    if (a.id === "ae-sheets") return -1;
    if (b.id === "ae-sheets") return 1;
    if (a.id === "find-and-replace-fonts") return -1;
    if (b.id === "find-and-replace-fonts") return 1;
    return a.data.sortOrder - b.data.sortOrder;
  })
  .map((p) => ({
    id: p.id,
    title: p.data.homeCard?.title ?? p.data.title,
    tagline: p.data.homeCard?.tagline ?? p.data.tagline,
    price: p.data.homeCard?.price ?? p.data.price,
    currency: p.data.homeCard?.currency ?? p.data.currency,
    status: p.data.status,
    category: p.data.category,
    heroImage: p.data.homeCard?.heroImage ?? p.data.heroImage,
    slug: `/${p.id}`,
    checkoutUrl: p.data.checkoutUrl,
    buyButtonLabel: p.data.homeCard?.buyButtonLabel ?? p.data.buyButtonLabel,
    features: p.data.homeCard?.features ?? p.data.features,
  }));

const itemListData = products.map((p) => ({
  name: p.title,
  url: `${SITE.domain}${p.slug}`,
  image: p.heroImage,
  description: p.tagline,
}));

const homepageFaqs = [
  {
    question: "What versions of After Effects do your plugins support?",
    answer:
      "Our extensions support Adobe After Effects 2024 (version 24.0) and newer on both macOS and Windows. We recommend keeping After Effects up to date for the best experience.",
  },
  {
    question: "Do your tools work on both Mac and Windows?",
    answer:
      "Yes. All Sidequest Plugins extensions and scripts are fully compatible with both macOS (Intel and Apple Silicon) and Windows.",
  },
  {
    question: "Are there free After Effects scripts available?",
    answer:
      "Yes — we offer free scripts including AE Calculator, AE Batch Renamer, and AE Safe Area Guides. Visit our Free AE Scripts page to browse and download them.",
  },
  {
    question: "How do I install a Sidequest Plugins extension?",
    answer:
      "Our extensions are distributed as ZXP files. You can install them using Adobe's Creative Cloud desktop app or a third-party extension manager like Anastasiy's Extension Manager. Free scripts are JSX files that you place directly in your After Effects Scripts folder.",
  },
  {
    question: "Can I use my license on multiple computers?",
    answer:
      "Yes. Each license allows activation on up to two machines at the same time — for example, your work and home computers.",
  },
];

const orgSchema = buildOrganizationSchema();
const siteSchema = buildWebSiteSchema();
const itemListSchema = buildItemListSchema(itemListData);
const faqSchema = buildFAQSchema(homepageFaqs);
---

<DefaultLayout
  title="After Effects Plugins, Scripts & Extensions"
  description={SITE.tagline}
  keywords="After Effects plugins, AE scripts, motion design tools, After Effects extensions, font replacement, spreadsheet automation, localization, After Effects workflow"
>
  <StructuredData slot="head" data={orgSchema} />
  <StructuredData slot="head" data={siteSchema} />
  <StructuredData slot="head" data={itemListSchema} />
  {faqSchema && <StructuredData slot="head" data={faqSchema} />}

  <Background className="via-muted to-muted/80">
    <Hero
      title="After Effects tools to supercharge your workflow"
      subtitle="AE scripts & extensions to speed up the boring parts so you can focus on the fun stuff."
      ctaText="Browse Products"
      ctaHref="#products"
      secondaryCtaText="Free Scripts"
      secondaryCtaHref="/free-ae-scripts"
    />
  </Background>

  <section class="py-12 md:py-16">
    <div class="container mx-auto max-w-3xl text-center">
      <p class="text-muted-foreground text-base leading-relaxed md:text-lg">
        We built the After Effects tools we wished existed.
        <a href="/ae-sheets" class="text-foreground underline underline-offset-4">AE&nbsp;Sheets</a> turns spreadsheets into localized comps.
        <a href="/find-and-replace-fonts" class="text-foreground underline underline-offset-4">Find&nbsp;and&nbsp;Replace&nbsp;Fonts</a> swaps fonts across entire projects in seconds.
        You just worry about the keyframes.
      </p>
    </div>
  </section>

  <AnimateOnScroll animation="fade-up">
    <Background variant="bottom">
      <div id="products">
        <ProductShowcase
          products={products}
          heading="After Effects Scripts & Extensions"
          description="Professional automation tools designed to eliminate repetitive work in After Effects — from spreadsheet-driven versioning to project-wide font management."
        />
      </div>
    </Background>
  </AnimateOnScroll>

  <FAQ
    items={homepageFaqs}
    heading="Frequently Asked Questions"
    client:only="react"
  />

  <AnimateOnScroll animation="fade-up">
    <EmailSignup client:visible />
  </AnimateOnScroll>
</DefaultLayout>
