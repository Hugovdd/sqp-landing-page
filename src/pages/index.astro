---
import { getCollection } from "astro:content";

import AnimateOnScroll from "@/components/AnimateOnScroll.astro";
import { Background } from "@/components/background";
import { EmailSignup } from "@/components/blocks/email-signup";
import { Hero } from "@/components/blocks/hero";
import { ProductShowcase } from "@/components/blocks/product-showcase";
import StructuredData from "@/components/StructuredData.astro";
import { SITE } from "@/consts";
import DefaultLayout from "@/layouts/DefaultLayout.astro";
import { buildOrganizationSchema, buildWebSiteSchema } from "@/lib/seo";

const allProducts = await getCollection("products");
const products = allProducts
  .filter((p) => !p.data.isFree)
  .sort((a, b) => {
    // Priority order
    if (a.id === "ae-sheets") return -1;
    if (b.id === "ae-sheets") return 1;
    if (a.id === "find-and-replace-fonts") return -1;
    if (b.id === "find-and-replace-fonts") return 1;
    
    // Default sort for others
    return a.data.sortOrder - b.data.sortOrder;
  })
  .map((p) => ({
    id: p.id,
    title: p.data.homeCard?.title ?? p.data.title,
    tagline: p.data.homeCard?.tagline ?? p.data.tagline,
    price: p.data.homeCard?.price ?? p.data.price,
    currency: p.data.homeCard?.currency ?? p.data.currency,
    status: p.data.status,
    category: p.data.category,
    heroImage: p.data.homeCard?.heroImage ?? p.data.heroImage,
    slug: `/${p.id}`,
    checkoutUrl: p.data.checkoutUrl,
    features: p.data.homeCard?.features ?? p.data.features,
  }));

const orgSchema = buildOrganizationSchema();
const siteSchema = buildWebSiteSchema();
---

<DefaultLayout
  title=""
  description={SITE.tagline}
>
  <StructuredData slot="head" data={orgSchema} />
  <StructuredData slot="head" data={siteSchema} />

  <Background className="via-muted to-muted/80">
    <Hero
      title="After Effects tools to supercharge your workflow"
      subtitle="Professional plugins, extensions, and scripts to speed up your After Effects workflow."
      ctaText="Browse Products"
      ctaHref="#products"
      secondaryCtaText="Free Scripts"
      secondaryCtaHref="/free-ae-scripts"
    />
  </Background>

  <AnimateOnScroll animation="fade-up">
    <Background variant="bottom">
      <div id="products">
      <ProductShowcase
        products={products}
        heading="Our Products"
        description="Tools built by motion designers, for motion designers."
      />
    </div>
    </Background>
    
  </AnimateOnScroll>

  <AnimateOnScroll animation="fade-up">
      <EmailSignup client:visible />
  </AnimateOnScroll>
</DefaultLayout>
