---
import { getEntry } from "astro:content";

import { FAQ } from "@/components/blocks/faq";
import { Features } from "@/components/blocks/features";
import { ProductHero } from "@/components/blocks/product-hero";
import AnimateOnScroll from "@/components/AnimateOnScroll.astro";
import StructuredData from "@/components/StructuredData.astro";
import DefaultLayout from "@/layouts/DefaultLayout.astro";
import {
  buildFAQSchema,
  buildOrganizationSchema,
  buildProductSchema,
} from "@/lib/seo";

const product = await getEntry("products", "ae-calculator");
if (!product) throw new Error("Product not found");

const { data } = product;
const productSchema = buildProductSchema(data);
const faqSchema = buildFAQSchema(data.faqs);
const orgSchema = buildOrganizationSchema();
---

<DefaultLayout
  title={data.seo.metaTitle}
  description={data.seo.metaDescription}
  keywords={data.seo.keywords}
>
  <StructuredData slot="head" data={orgSchema} />
  <StructuredData slot="head" data={productSchema} />
  {faqSchema && <StructuredData slot="head" data={faqSchema} />}

  <ProductHero
    title={data.title}
    tagline={data.tagline}
    price={data.price}
    currency={data.currency}
    version={data.version}
    status={data.status}
    supportedApp={data.supportedApp}
    extensionType={data.extensionType}
    checkoutUrl={data.checkoutUrl}
    heroImage={data.heroImage}
    stats={data.stats}
  />

  {data.features.length > 0 && (
    <AnimateOnScroll animation="fade-up">
      <Features features={data.features} />
    </AnimateOnScroll>
  )}

  {data.faqs.length > 0 && (
    <AnimateOnScroll animation="fade-up">
      <FAQ client:visible items={data.faqs} />
    </AnimateOnScroll>
  )}
</DefaultLayout>
